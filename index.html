<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Genesis Collective</title>
    <style>
        /* Base CSS - Clean & Professional Style (Cyberpunk/Neon Theme) */
        :root {
            --color-dark: #0a0a2a;
            --color-gold: #FFD700;
            --color-cyan: #00FFFF;
            --color-text: #E0E0FF;
            --color-bg-light: #1c1c4f;
            --color-danger: #ff4d4d;
            --color-primary-accent: #00bfff;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: var(--color-dark);
            color: var(--color-text);
            margin: 0;
            padding: 0;
            line-height: 1.6;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 50% 10%, rgba(0, 255, 255, 0.1), transparent 30%),
                        radial-gradient(circle at 80% 90%, rgba(255, 0, 255, 0.1), transparent 40%);
            z-index: -2;
        }
        .background-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: linear-gradient(to right, rgba(0, 255, 255, 0.08) 1px, transparent 1px),
                              linear-gradient(to bottom, rgba(255, 215, 0, 0.08) 1px, transparent 1px);
            background-size: 50px 50px;
            opacity: 0.3;
            z-index: -1;
            pointer-events: none;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: auto;
            padding: 20px 0;
            position: relative;
            z-index: 10;
        }

        header {
            background-color: rgba(28, 28, 79, 0.85);
            padding: 15px 0;
            border-bottom: 2px solid var(--color-gold);
            text-align: center;
            backdrop-filter: blur(5px);
            position: sticky;
            top: 0;
            z-index: 20;
        }
        
        header h1 {
            color: var(--color-cyan);
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }

        /* Wallet Status and Connect Button */
        #wallet-status {
            font-size: 0.9em;
            padding: 10px 0;
            text-align: right;
        }

        #connect-wallet-btn {
            background-color: var(--color-cyan);
            color: var(--color-dark);
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s, transform 0.2s;
            box-shadow: 0 0 15px var(--color-cyan);
        }

        #connect-wallet-btn:hover {
            background-color: #66FFFF;
            transform: scale(1.05);
        }
        
        /* Hero Section - Dual Panel Layout */
        .hero-section {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            padding: 60px 0;
            text-align: center;
        }

        .card {
            background-color: rgba(28, 28, 79, 0.9);
            padding: 30px;
            border-radius: 12px;
            flex: 1;
            min-width: 300px;
            border: 1px solid rgba(255, 215, 0, 0.5);
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.2);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 40px rgba(0, 255, 255, 0.4);
        }

        .card h2 {
            color: var(--color-gold);
            margin-top: 0;
            text-shadow: 0 0 5px rgba(255, 215, 0, 0.7);
        }

        .logo-placeholder {
            width: 150px;
            height: 150px;
            margin: 0 auto 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: bold;
            box-shadow: 0 0 20px;
        }

        .nft-logo {
            background-color: var(--color-gold);
            color: var(--color-dark);
            box-shadow: 0 0 20px var(--color-gold);
        }

        .token-logo {
            background-color: var(--color-cyan);
            color: var(--color-dark);
            box-shadow: 0 0 20px var(--color-cyan);
        }
        
        /* Input and Button Group */
        .input-group {
            margin-top: 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .input-group input {
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--color-cyan);
            background-color: var(--color-dark);
            color: var(--color-text);
            text-align: center;
            font-size: 1.1em;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--color-gold);
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        
        .cta-button {
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s, box-shadow 0.3s;
            text-transform: uppercase;
        }

        .cta-mint-nft {
            background-color: var(--color-gold);
            color: var(--color-dark);
            box-shadow: 0 0 15px var(--color-gold);
        }

        .cta-mint-token {
            background-color: var(--color-cyan);
            color: var(--color-dark);
            box-shadow: 0 0 15px var(--color-cyan);
        }
        
        .cta-button:hover {
            transform: translateY(-2px);
            opacity: 0.9;
        }

        /* Tokenomics Section */
        .tokenomics-section {
            background-color: rgba(28, 28, 79, 0.9);
            padding: 40px;
            border-radius: 12px;
            margin-top: 40px;
            text-align: left;
            border: 1px solid rgba(0, 255, 255, 0.3);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.15);
        }
        
        .tokenomics-section h2 {
             color: var(--color-gold);
        }

        .tokenomics-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 30px;
            margin-top: 30px;
            text-align: center;
        }

        .tokenomics-item {
            padding: 20px;
            border: 1px dashed rgba(255, 255, 255, 0.2);
            border-radius: 8px;
        }

        .tokenomics-item h3 {
            color: var(--color-cyan);
            margin-bottom: 5px;
            font-size: 1.8em;
            text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
        }
        
        /* Media Queries for Mobile */
        @media (max-width: 768px) {
            .hero-section {
                flex-direction: column;
            }
            .tokenomics-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
    
</head>
<body>
    
    <div class="background-overlay"></div> 
    
    <header>
        <div class="container">
            <div id="wallet-status">
                <span id="wallet-status-text" style="color: var(--color-danger);">Wallet Disconnected</span>
                <button id="connect-wallet-btn" >Connect Wallet (EVM)</button>
            </div>
            <h1>THE GENESIS COLLECTIVE</h1>
            <p>Exclusive ownership & mass utility. Fully Tracked on X402Scan.</p>
        </div>
    </header>

    <div class="container">
        <section class="hero-section">
            
            <div class="card nft-card">
                <div class="logo-placeholder nft-logo">NFT $GEN</div>
                <h2>GENESIS NFT ACCESS ($GEN)</h2>
                <p>Limited Supply: **10,000 NFT**</p>
                <p>Key to Token Claim, Airdrop Pass, & Deflationary Trading.</p>
                
                <p style="font-size: 1.4em; color: var(--color-gold);">
                    **1 NFT = 10,000 $COLLECT Claim**
                </p>
                
                <div class="input-group">
                    <input type="number" id="nft-quantity" placeholder="Quantity (Max 10 per Tx)" value="1" min="1" max="10">
                    <p id="nft-price-display" style="margin: 5px 0; font-weight: bold; font-size: 0.9em; color: var(--color-gold);">
                        Price: 10 USDC per NFT
                    </p>
                    
                    <button class="cta-button cta-mint-nft" id="mint-nft-btn">
                        MINT $GEN NFT
                    </button>
                </div>
            </div>

            <div class="card token-card">
                <div class="logo-placeholder token-logo">Token $COLLECT</div>
                <h2>COLLECTIVE UTILITY TOKEN ($COLLECT)</h2>
                <p>Total Supply: **1,000,000,000 (1B)**</p>
                <p>Core Community Token, DeFi Ready.</p>
                
                <p style="font-size: 1.4em; color: var(--color-cyan);">
                    **RATE:** 1 USDC = 5,000 $COLLECT
                </p>

                <div class="input-group">
                    <input type="number" id="usdc-amount" placeholder="USDC Amount to Spend (Min 1)" value="10" min="1">
                    <input type="text" id="token-receive" value="Receive: 50,000 $COLLECT" readonly>
                    
                    <button class="cta-button cta-mint-token" id="mint-token-btn">
                        BUY $COLLECT TOKEN
                    </button>
                </div>
            </div>
            
        </section>
        
        <section class="tokenomics-section">
            <h2>TOKENOMICS & $COLLECT DISTRIBUTION</h2>
            <p style="margin-bottom: 30px;">Engineered for massive distribution, strong liquidity, and sustainable growth.</p>

            <div class="tokenomics-grid">
                <div class="tokenomics-item">
                    <h3 style="color: var(--color-gold);">50%</h3>
                    <p><strong>MINT & CLAIM</strong></p>
                    <p>Allocated for $GEN NFT holders claim and initial public token minting.</p>
                </div>
                <div class="tokenomics-item">
                    <h3 style="color: var(--color-gold);">40%</h3>
                    <p><strong>LIQUIDITY POOL (LP)</strong></p>
                    <p>Permanently locked to ensure deep market depth and stable trading (Uniswap/DEX).</p>
                </div>
                <div class="tokenomics-item">
                    <h3 style="color: var(--color-gold);">10%</h3>
                    <p><strong>TREASURY & DEVELOPMENT</strong></p>
                    <p>Reserved for marketing, exchange listing fees, and future project expansion.</p>
                </div>
            </div>
        </section>

        <section style="padding: 40px 0; margin-top: 20px;">
            <h2 style="text-align: center; color: var(--color-cyan);">EXCLUSIVE $GEN NFT UTILITIES</h2>
            <ul style="list-style-type: none; padding: 0;">
                <li>ðŸ’Ž **Immutable Claim:** Each NFT guarantees 10,000 $COLLECT Tokens.</li>
                <li>ðŸ”¥ **Fee Deflationary Lock:** NFT holder trades are **BURNED**, actively reducing $COLLECT supply.</li>
                <li>ðŸš€ **Alpha Airdrop Pass:** Guaranteed allocation/whitelist in ALL future project drops.</li>
            </ul>
        </section>
        
        <div id="status-and-error" style="text-align: center; margin-top: 30px;">
            <div id="gas-display" style="color: var(--color-text);"></div> 
            <div id="status-message" style="color: #39ff14; font-weight: bold; margin-top: 10px;"></div>
            <div id="error-message" style="color: var(--color-danger); font-weight: bold; margin-top: 5px;"></div>
        </div>
        
    </div>

    <footer>
        <p>
            Contract Transparency Verification: <a href="https://basescan.org" target="_blank">BaseScan Explorer</a>
        </p>
        <p>
            <a href="#">Twitter</a> | 
            <a href="#">Discord</a> | 
            <a href="#">Litepaper</a>
        </p>
        <p style="margin-top: 10px; font-size: 0.8em;">**Disclaimer:** Trading crypto assets is highly risky. Use at your own risk.</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

    <script>
        // *******************************************************************
        // KONFIGURASI WEB3 DAN LOGIKA
        // *******************************************************************

        const TOKEN_RATE = 5000;         // 1 USDC = 5,000 $COLLECT
        const NFT_PRICE_USD = 10;        // 1 NFT = 10 USDC
        const BASE_USD_PRICE = 1000000;  // 1 USDC (dalam 6 desimal USDC)
        const CHAIN_ID = 8453;           // Base Mainnet

        // --- ALAMAT KONTRAK WAJIB DI GANTI ---
        // Ganti dengan alamat yang benar setelah deployment
        const NFT_SALE_CONTRACT = "0x...NFT_SALE_ADDRESS..."; 
        const TOKEN_SALE_CONTRACT = "0x...TOKEN_SALE_ADDRESS..."; 
        const USDC_CONTRACT_ADDRESS = "0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913"; // USDC Base Mainnet
        
        // --- RELAYER / BACKEND ---
        // Ganti dengan domain API yang sudah terkonfigurasi Nginx/HTTPS
        const RELAYER_URL_BASE = "https://api.us-ai.fun"; 

        // --- Variabel Global ---
        let signer;
        let provider;
        let userAddress;

        // Element UI
        const gasDisplay = document.getElementById('gas-display');
        const statusMessage = document.getElementById('status-message');
        const errorMessage = document.getElementById('error-message');
        const connectBtn = document.getElementById('connect-wallet-btn');
        const nftMintBtn = document.getElementById('mint-nft-btn');
        const tokenMintBtn = document.getElementById('mint-token-btn');
        const walletStatusText = document.getElementById('wallet-status-text');

        // ABI Minimal untuk fungsi mintWithPermit dan wallet()
        const saleAbi = ["function wallet() view returns (address)"];


        // *******************************************************************
        // FUNGSI UTAMA 1: KONEKSI WALLET
        // *******************************************************************

        async function connectWallet() {
    errorMessage.textContent = '';
    statusMessage.textContent = 'Connecting...';
    gasDisplay.textContent = 'Fetching gas price...';

    if (typeof window.ethereum === 'undefined') {
        errorMessage.textContent = 'MetaMask atau dompet EVM tidak terdeteksi.';
        return;
    }

    try {
        // 1. Minta izin koneksi dan dapatkan provider/signer
        await window.ethereum.request({ method: 'eth_requestAccounts' });
        provider = new ethers.providers.Web3Provider(window.ethereum);
        signer = provider.getSigner();
        userAddress = await signer.getAddress();

        // 2. Cek Jaringan
        const { chainId } = await provider.getNetwork();
        if (chainId !== CHAIN_ID) {
            errorMessage.textContent = 'Harap pindah ke jaringan Base Mainnet.';
            return;
        }

        // 3. Deteksi Harga Gas
        try {
            const feeData = await provider.getFeeData();
            // Ethers v5 BigNumber.div()
            const gasPriceInGwei = feeData.gasPrice.div(1000000000); 
            gasDisplay.textContent = `âš¡ Gas: ${gasPriceInGwei.toString()} Gwei (Gas dibayar oleh Server)`;
        } catch (gasError) {
            gasDisplay.textContent = 'Could not fetch gas price.';
        }

        // 4. Ambil alamat wallet owner (diperlukan untuk payload signature)
        statusMessage.textContent = 'Fetching sale configuration...';
        const saleContract = new ethers.Contract(TOKEN_SALE_CONTRACT, saleAbi, provider); // Menggunakan TOKEN_SALE_CONTRACT sebagai titik awal
        ownerWalletAddress = await saleContract.wallet();

        if (!ownerWalletAddress) {
             errorMessage.textContent = 'Failed to read owner wallet address from contract.'; 
             return;
        }
        
        // 5. Update UI sukses
        walletStatusText.textContent = `Wallet: ${userAddress.substring(0, 6)}...${userAddress.substring(38)} (Connected)`;
        walletStatusText.style.color = '#39ff14';
        connectBtn.textContent = 'Wallet Connected';
        connectBtn.disabled = true;
        
        statusMessage.textContent = `âœ… Connected to Base Mainnet. Owner Wallet: ${ownerWalletAddress.substring(0, 6)}...`;

    } catch (error) {
        console.error("Koneksi Wallet Gagal:", error);
        errorMessage.textContent = `Connection aborted or failed to read contract.`;
        walletStatusText.textContent = 'Wallet Disconnected';
        walletStatusText.style.color = 'var(--color-danger)';
    }
}

        // *******************************************************************
        // FUNGSI UTAMA 2: MINT NFT (POST ke Relayer /mint-nft)
        // *******************************************************************

        async function mintNFT() {
            if (!signer) return alert("Harap hubungkan dompet terlebih dahulu.");
            
            const quantity = document.getElementById('nft-quantity').value;
            if (parseInt(quantity) < 1) return alert("Jumlah NFT minimal 1.");
            
            statusMessage.textContent = '1. Meminta Tanda Tangan Permit... (Gratis)';

            // --- LOGIKA PERMIT SIGNATURE ---
            const totalUSDCAmount = parseFloat(quantity) * NFT_PRICE_USD;
            const valueWei = (totalUSDCAmount * BASE_USD_PRICE).toString();
            
            try {
                // 1. Ambil Alamat Owner (untuk Permit)
                const saleContract = new ethers.Contract(NFT_SALE_CONTRACT, saleAbi, provider);
                const ownerWalletAddress = await saleContract.wallet();
                
                // 2. Buat Payload Permit
                const nonce = ethers.utils.solidityKeccak256(["uint256", "uint256"], [userAddress, Date.now()]);
                const message = {
                    from: userAddress,
                    to: ownerWalletAddress, // WAJIB: Alamat Owner Anda
                    value: valueWei, // Total USDC dalam Wei
                    validAfter: 0,
                    validBefore: Math.floor(Date.now() / 1000) + 900, 
                    nonce: nonce,
                };
                
                // 3. Tandatangani (Pop-up Gratis)
                const signature = await signer._signTypedData({ name: 'USD Coin', version: '2', chainId: CHAIN_ID, verifyingContract: USDC_CONTRACT_ADDRESS }, 
                    { TransferWithAuthorization: [{ name: 'from', type: 'address' }, { name: 'to', type: 'address' }, { name: 'value', type: 'uint256' }, { name: 'validAfter', type: 'uint256' }, { name: 'validBefore', type: 'uint256' }, { name: 'nonce', type: 'bytes32' }] }, 
                    message);
                const sigParts = ethers.utils.splitSignature(signature);

                statusMessage.textContent = '2. Signature didapatkan. Mengirim ke Relayer...';

                // 4. Kirim ke Endpoint NFT BARU
                const response = await fetch(`${RELAYER_URL_BASE}/mint-nft`, { 
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        buyerAddress: userAddress,
                        quantity: quantity, 
                        validAfter: message.validAfter,
                        validBefore: message.validBefore,
                        nonce: message.nonce,
                        v: sigParts.v,
                        r: sigParts.r,
                        s: sigParts.s
                    })
                });

                if (!response.ok) {
                    const errorBody = await response.json(); // Asumsikan server mengirim JSON error
                    throw new Error(errorBody.error || `Server error (Status ${response.status})`);
                }

                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || "Mint NFT Gagal: Transaksi tidak berhasil.");
                }

                alert(`MINT NFT SUKSES! Tx Hash: ${result.txHash}`);
                statusMessage.textContent = `âœ… Mint NFT SUKSES! Tx: ${result.txHash.substring(0,10)}...`;


            } catch (error) {
                console.error("Mint NFT Gagal:", error);
                errorMessage.textContent = `Mint NFT Gagal: ${error.message || "Cek log konsol."}`;
            }
        }

        // *******************************************************************
        // FUNGSI UTAMA 3: BELI TOKEN (POST ke Relayer /buy-token)
        // *******************************************************************

        async function mintToken() {
            if (!signer) return alert("Harap hubungkan dompet terlebih dahulu.");
            
            const usdcAmount = document.getElementById('usdc-amount').value;
            if (parseFloat(usdcAmount) < 1) return alert("Pembelian minimal 1 USDC.");

            // ... (Logika Permit Signature & Pengiriman ke /buy-token sama) ...
        }

        // --- UTILITY FUNCTIONS ---
        function updateTokenReceive() {
            const usdcInput = document.getElementById('usdc-amount');
            const tokenOutput = document.getElementById('token-receive');
            const usdcAmount = parseFloat(usdcInput.value.replace(/,/g, ''));
            
            if (isNaN(usdcAmount) || usdcAmount < 1) {
                usdcInput.value = 1;
                tokenOutput.value = 'Receive: 5,000 $COLLECT';
                return;
            }
            
            usdcInput.value = usdcAmount;
            const receivedTokens = usdcAmount * TOKEN_RATE;
            const formattedTokens = receivedTokens.toLocaleString('en', { minimumFractionDigits: 0, maximumFractionDigits: 0 });

            tokenOutput.value = `Receive: ${formattedTokens} $COLLECT`;
        }

        // *******************************************************************
        // EVENT LISTENERS
        // *******************************************************************
        
        window.onload = function() {
    // ... (Logika update token receive) ...
    document.getElementById('usdc-amount').addEventListener('input', updateTokenReceive);

    // --- EVENT LISTENERS FINAL ---
    document.getElementById('connect-wallet-btn').addEventListener('click', connectWallet);
    document.getElementById('mint-nft-btn').addEventListener('click', mintNFT);
    document.getElementById('mint-token-btn').addEventListener('click', mintToken);
};
        
    </script>
</body>
</html>
